{% extends 'Base/base.html' %}
{% load static %}
{% block content %}
<div class="container mt-5">
    <h1>Applicants for {{ job.title }}</h1>
    <p>This is the company applicants view for {{ company.company_name }}</p>
    <ul class="list-group">
        {% for applicant in applicants %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <span>
                    {{ applicant.full_name }} - {{ applicant.email }}
                </span>
                <span>
                    <button class="btn btn-success btn-sm mr-2" onclick="updateStatus('{{ applicant.id }}', 'accepted')">Accept</button>
                    <button class="btn btn-danger btn-sm" onclick="updateStatus('{{ applicant.id }}', 'rejected')">Reject</button>
                </span>
            </li>
        {% endfor %}
    </ul>
</div>

<script>
    function updateStatus(applicantId, status) {
        fetch('/Company/update_status/', {  // Adjusted the URL here
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'  // Add CSRF token for security
            },
            body: JSON.stringify({
                'applicant_id': applicantId,
                'status': status
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Status updated successfully');
                location.reload();  // Reload the page to reflect changes
            } else {
                alert('Failed to update status');
            }
        })
        .catch(error => console.error('Error:', error));
    }
</script>
{% endblock %}
